<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciamento de Alunos</title>
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css"
    />
    <link rel="stylesheet" href="style/custom.css">
    <link rel="stylesheet" href="style/gerenciamento_aluno.css">
  </head>
  <header class="header">
    <img src="./imagens/Logo.png" alt="logo" />
  </header>
  <body>
    <h1 class="texto-titulo">Gerenciamento de Alunos</h1>
    <button id="buttonNovoAluno">Criar novo aluno</button>
    <div id="aluno-container" class="divAlunos">
    </div>
  </body>
  <div class="muleke">
    <a href="index.html">
      <img src="./imagens/mascote2.png" alt="mascote" />
    </a>
  </div>
  <dialog id="favDialog">
    <form method="dialog">
        <section>
            <label ><strong>Nome:</strong></label>
            <input type="text" id="nomeNovoALuno">
            <label ><strong>Sexo:</strong></label>
            <input type="text" id="sexoNovoAluno">
            <label ><strong>Data de nascimento:</strong></label>
            <input type="date" id="dataNascNovoAluno">
        </section>
        <menu>
        <button id="submit" type="submit">Confirmar</button>
        </menu>
    </form>
    </dialog>

</html>
<script>
getInfoAlunos()
async function getInfoAlunos() {
    try {
        const response = await fetch(
        "http://127.0.0.1:8080/api/v1/alunos/listar"
        );
        const alunos = await response.json();
        mostraAlunos(alunos)
    } catch (error) {
        console.error("Erro ao buscar dados da API -> ", error);
        return null;
    }
}

const renderizarAluno = (aluno) => {
  const quadrado = document.createElement("div");
  quadrado.className = "quadrado";

  const labelRa = document.createElement("p");
  labelRa.textContent = aluno.RA;
  quadrado.appendChild(labelRa);

  const labelNome = document.createElement("p");
  labelNome.textContent = aluno.nome;
  quadrado.appendChild(labelNome);

  const labelSexo = document.createElement("p");
  labelSexo.textContent = aluno.sexo;
  quadrado.appendChild(labelSexo);

  const labelIdade = document.createElement("p");
  labelIdade.textContent = aluno.data_nascimento;
  quadrado.appendChild(labelIdade);

  alunos = document.getElementById("aluno-container")

  const imagemIconEdit = document.createElement("img")
      imagemIconEdit.src = "../front/icon/trash-icon.svg"
      imagemIconEdit.alt ="Icone"
      imagemIconEdit.className = "trash-icon"
      imagemIconEdit.id = `delete${aluno.RA}`;
      imagemIconEdit.addEventListener("click", () => deleteAluno(`${aluno.RA}`))
      quadrado.appendChild(imagemIconEdit);
  alunos.appendChild(quadrado);
};

const mostraAlunos = (alunos) => {
    for (const id in alunos) {
      renderizarAluno(alunos[id]);
    }
}

const deleteAluno = (RA) => {
  try {
      fetch (`http://127.0.0.1:8080/api/v1/alunos/deletar/${RA}`,{method: "POST"})
      console.log('chamou o deletar')
      } catch (error) {
          console.error("Erro ao buscar dados da API -> ", error);
      }
var favDialog = document.getElementById("favDialog");
var botaoNovoAluno = document.getElementById("buttonNovoAluno");
var submitButton = document.getElementById("submit");

botaoNovoAluno.addEventListener("click", function () {
    favDialog.showModal();
  });

submitButton.addEventListener("click", function () {
    criarNovoAluno();
    favDialog.close();
  });
}

const criarNovoAluno = () => {
    nomeNovo = document.getElementById('nomeNovoALuno').value
    sexoNovo = document.getElementById('sexoNovoAluno').value
    dataNascNova = document.getElementById('dataNascNovoAluno').value

    const alunoNovo = {
        "nome":nomeNovo,
        "sexo": sexoNovo,
        "data_nascimento":dataNascNova
    }
    try {
      fetch ('http://127.0.0.1:8080/api/v1/alunos/criar',{method: "POST", body:JSON.stringify(alunoNovo)})
      console.log('chamou o back')
      } catch (error) {
          console.error("Erro ao buscar dados da API -> ", error);
      }

}
</script>