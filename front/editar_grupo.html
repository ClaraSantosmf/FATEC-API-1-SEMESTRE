<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, inicial-scale-1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css">
  <link rel="stylesheet" href="style/custom.css">
  <!-- <link rel="stylesheet" href="./style/editar_grupo.css"> -->
  <title>PBLTex ::. Editar Grupo</title>
</head>
<body onload="preencher_campos_formulario(obter_id())">
  <header class="header">
    <img src="./imagens/Logo.png" alt="logo">
  </header>
  <div>
    <h1>Formulário de Ediçao de Grupo</h1>
  </div>
  <div>
    <div>
      <div>
        Nome da Turma: <span id="fnome"></span>
      </div>
      <div>
        Professor responsável: <span id="fprofessor"></span>
      </div>
    </div>
    <div style="padding-top: 34px;">
      <div>
        <label for="fgrupo"><strong>Nome do Grupo:</strong></label>
        <input type="text" name="fgrupo" id="fgrupo">
      </div>
      <div style="padding-top: 21px;">
        <button onclick="requisitar_editar_grupo(obter_id())">Salvar</button>
      </div>
    </div>
  </div>
      <div>
        <label for="alunos"><strong>Alunos da Turma:</strong></label>
        <select name="alunos" id="lista-alunos-turma"></select>
      </div>
        <button onclick="adicionar_aluno_grupo()">Adicionar Aluno</button>
      <div id="alunos_grupo">
        <label for="alunos"><strong>Alunos do Grupo:</strong></label>
        <select name="alunos" id="lista-alunos-grupo"></select>
      </div>
        <button onclick="remover_aluno_grupo()">Remover Aluno</button>

<script>
lista_alunos_grupo(alunos_grupo)
  /** Realiza o preenchimento inicial dos campos do formulario
  @param (string) id _ o identificador único do grupo.
*/
  async function preencher_campos_formulario(id){
    const grupo = await obter_grupo(id)
    if(grupo){
      document.getElementById('fgrupo')['value'] = grupo[`nome`]
      console.log(grupo)
      const turma = await obter_turma(grupo["turma"])
      if (turma){
        document.getElementById('fnome')['innerText'] = turma[`nome`]
        document.getElementById('fprofessor')['innerText'] = turma[`professor`]
      }
  }
}
  /** Obtém uma turma pelo id
         * @param {string} id - o identificador único da turma.
         * @returns {object} retornará undefined ou um objeto contendo os atributos nome, professor e data_de_inicio.
        */
        async function obter_turma(id) {
            const resposta = await fetch (`http://localhost:8080/api/v1/turmas/listar/${id}`, {method: "GET"})
            const turma = await resposta.json()
            console.log(turma)
            return turma
        }
  /** Realiza a submissão da edição da turma para o backend
   * @param(string) id - o identificador do grupo.
   */
function requisitar_editar_grupos(id){
  editaNomeGrupo(id)
}

async function editaNomeGrupo(id){
  const decisao_usuario = true
  //criar_modal_confirmacao_edicao();
  if(decisao_usuario){
    console.log('passei')
    const grupo = {
      "nome" : document.getElementById('fnome')['value'],

    }
    console.log(document.getElementById('fnome')['value'])
    fetch (`https://localhost:8080/api/v1/grupo/editar:id${id}/`,{method: "POST", body:JSON.stringify(grupo)})
    .then(() => window.location.href = 'editar_grupo.html?id=' + id)
  }

}
/** Obtém o grupo pelo id
 * *@param (string) id - identificador único do grupo
 * *@returns(object) rertonará undefined ou um objeto
 * */
async function obter_grupo(id) {
  const resposta = await fetch (`http://localhost:8080/api/v1/grupos/obter/${id}`, {method: "GET"})
      const grupo = await resposta.json()
      console.log(grupo)
      return grupo
}
/** Recupera o id do grupo presente como consulta na URL
* @returns (string) id - o identificador único
*/
  function obter_id(){ return new URLSearchParams(window.location.search).get('id') }
        
/** Cria um modal para a confirmação do usuário
* @return (boolean) resposta - decisão do usuário
*/
  function criar_modal_confirmar_edicao(){
  const mensagem = "Atenção! Os dados do grupo serão modificados.\nDeseja prosseguir com a edição?"
  return window.confirm(mensagem);
}







// Função para buscar grupo no servidor

async function GetGruposAlunos() {
  try {
    const response = await fetch("http://127.0.0.1:8080/api/v1/grupoalunos/listar");
    grupos_alunos = await response.json();
    console.log(grupos_alunos);

    // Chama a função para exibir as grupo
    exibirGruposAlunos(grupos_alunos);
  } catch (error) {
    console.error("Erro ao buscar dados da API -> ", error);
    return null;
  }
}

function remover_aluno_grupo(id){
  if(window.confirm("Atenção! O Aluno será excluído.\nDeseja prosseguir?")){
    fetch(`http://localhost:8080/api/v1/grupoalunos/remover/:id${id}`,{method:'DELETE'}).then(document.getElementById(id).remove())
  }  
}

// Função para exibir os alunos do grupo no DOM
function exibirGruposAlunos(grupos_alunos) {
  const container = document.querySelector(".flex-warp-container");
  // Itera sobre os objetos do JSON e cria elementos HTML para cada aluno
  for (const alunoId in grupos_alunos) {
    if (grupos_alunos.hasOwnProperty(alunoId)) {
      const grupo = grupos_alunos[alunoId];

      // Cria um elemento div para representar uma aluno
      const grupos = document.createElement("div");
      grupoSquare.className = "turma-square";
      grupoSquare.id = `${alunoId}`; // Adiciona o ID da aluno ao grupoSquare

      // Cria um ícone de lixeira para deletar o aluno
      const imagemIcon = document.createElement("img");
      imagemIcon.src = "../front/icon/trash-icon.svg";
      imagemIcon.alt = "Ícone";
      imagemIcon.className = "trash-icon";
      imagemIcon.id = `${alunoId}`; // Adiciona o ID da aluno ao ícone de deletar
      imagemIcon.addEventListener("click",() =>remover_aluno_grupo(`${alunoId}`))

      // Adiciona o ícone ao turmaSquare
      turmaSquare.appendChild(imagemIcon);

      // Adiciona o turmaSquare ao container
      container.appendChild(grupoSquare);
    }
  }
}













/*
 //A função criar_componente é responsável por criar dinamicamente um componente HTML com base nos dados de um grupo.
 function criar_componente(id, aluno){     
            let div = document.getElementById("main")
            let grupoDiv = document.createElement("div")
            grupoDiv.setAttribute("class", "divGrupoStyle")
        
            let nomeGrupoDiv = document.createElement("div")
            let rotuloNomeGrupo = document.createElement("strong")
            rotuloNomeGrupo.textContent = "Nome do grupo:"
            nomeGrupoDiv.appendChild(rotuloNomeGrupo)
            let nomeGrupo = document.createElement("p")
            nomeGrupo.textContent = grupo.nome
            nomeGrupoDiv.appendChild(nomeGrupo)
            
            let nomeTurmaDiv = document.createElement("div")
            let rotuloTurma = document.createElement("strong")
            rotuloTurma.textContent = "Turma:"
            nomeTurmaDiv.appendChild(rotuloTurma)
            let nomeTurma = document.createElement("p")
            nomeTurma.textContent = grupo.turma
            nomeTurmaDiv.appendChild(nomeTurma)

            let iconeDiv = document.createElement("div")
            iconeDiv.setAttribute("class","divIconeStyle")

            let iconeRemocao = document.createElement("i")
            iconeRemocao.setAttribute("class", "iconeRemocaoStyle")
            iconeRemocao.classList.add("fa", "fa-trash", "iconeRemocaoStyle")
            iconeRemocao.addEventListener("click", (evento) => {console.log(evento); alert("Remoção de grupo.")})
            iconeDiv.appendChild(iconeRemocao)
            
            grupoDiv.appendChild(nomeGrupoDiv)
            grupoDiv.appendChild(nomeTurmaDiv)
            grupoDiv.appendChild(iconeDiv)
            div.appendChild(grupoDiv)
        }
        
        //A função listar busca os grupos e cria os componentes. 
        //A palavra-chave await é usada para aguardar a função get_grupos buscar os grupos antes de prosseguir.
        async function listar(){    
            let grupos = await get_grupos() 
            for(id_grupo in grupos){
                console.log(id_grupo)
                criar_componente(id_grupo, grupos[id_grupo])
            }
        }

        //A função get_grupos busca os grupos na API backend.
        //A palavra-chave await é usada para aguardar a resposta da API e, em seguida, converte a resposta para o formato JSON usando o método response.json().
        //Os grupos buscados são então registrados no console e retornados.
        async function get_grupos() {   
            const resposta = await fetch (`http://localhost:8080/api/v1/grupos/listar`, {method: "GET"})    
            const grupos = await resposta.json()
            console.log(grupos)
            return grupos   
        }

        listar()
*/
</script>
