<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, inicial-scale-1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css">
  <link rel="stylesheet" href="style/custom.css">
  <!-- <link rel="stylesheet" href="./style/editar_grupo.css"> -->
  <title>PBLTex ::. Editar Grupo</title>
</head>
<body onload="preencher_campos_formulario(obter_id())">
  <header class="header">
    <img src="./imagens/Logo.png" alt="logo">
  </header>
  <div>
    <h1>Formulário de Ediçao de Grupo</h1>
  </div>
  <div>
    <div>
      <div>
        Nome da Turma: <span id="fnome"></span>
      </div>
      <div>
        Professor responsável: <span id="fprofessor"></span>
      </div>
    </div>
    <div style="padding-top: 34px;">
      <div>
        <label for="fgrupo"><strong>Nome do Grupo:</strong></label>
        <input type="text" name="fgrupo" id="fgrupo">
      </div>
      <div style="padding-top: 21px;">
        <button onclick="requisitar_editar_grupo(obter_id())">Salvar</button>
      </div>
    </div>
  </div>
      <div>
        <label for="alunos"><strong>Alunos da Turma:</strong></label>
        <select name="alunos" id="lista-alunos-turma"></select>
      </div>
        <button onclick="adicionar_aluno_grupo()">Adicionar Aluno</button>
      <div>
        <label for="alunos"><strong>Alunos do Grupo:</strong></label>
        <select name="alunos" id="lista-alunos-grupo"></select>
      </div>
        <button onclick="remover_aluno_grupo()">Remover Aluno</button>

<script>
  /** Realiza o preenchimento inicial dos campos do formulario
  @param (string) id _ o identificador único do grupo.
*/
  async function preencher_campos_formulario(id){
    const grupo = await obter_grupo(id)
    if(grupo){
      document.getElementById('fgrupo')['value'] = grupo[`nome`]
      const turma = await obter_turma(grupo["nome"])
      if (turma){
        document.getElementById('fnome')['innerText'] = turma[`nome`]
        document.getElementById('fprofessor')['innerText'] = turma[`professor`]
      }
  }
}
  /** Obtém uma turma pelo id
         * @param {string} id - o identificador único da turma.
         * @returns {object} retornará undefined ou um objeto contendo os atributos nome, professor e data_de_inicio.
        */
        async function obter_turma(id) {
            const resposta = await fetch (`http://localhost:8080/api/v1/turmas/listar/${id}`, {method: "GET"})
            const turma = await resposta.json()
            console.log(turma)
            return turma
        }
  /** Realiza a submissão da edição da turma para o backend
   * @param(string) id - o identificador do grupo.
   */
async function requisitar_editar_grupo(id){
  const decisao_usuario = criar_modal_confirmacao_edicao();
  if(decisao_usuario){
    const grupo = {
      "grupo" : document.getElementById('fgrupo')['value'],
      "nome" : document.getElementById('fnome')['value'],
      "professor" : document.getElementById('fprofessor')['value'],
      "data_de_inicio" : document.getElementById('fdata')['value']
    }
    fetch (`substituir por rota${id}/`,{method: "POST", body:JSON.stringify(grupo)})
    .then(() => window.location.href = 'editar_grupo.html?id=' + id)
  }
}
/** Obtém o grupo pelo id
 * *@param (string) id - identificador único do grupo
 * *@returns(object) rertonará undefined ou um objeto
 * */
async function obter_grupo(id) {
  const resposta = await fetch (`http://localhost:8080/api/v1/grupos/obter/${id}`, {method: "GET"})
      const grupo = await resposta.json()
      console.log(grupo)
      return grupo
}
/** Recupera o id do grupo presente como consulta na URL
* @returns (string) id - o identificador único
*/
  function obter_id(){ return new URLSearchParams(window.location.search).get('id') }
        
/** Cria um modal para a confirmação do usuário
* @return (boolean) resposta - decisão do usuário
*/
  function criar_modal_confirmar_edicao(){
  const mensagem = "Atenção! Os dados do grupo serão modificados.\nDeseja prosseguir com a edição?"
  return window.confirm(mensagem);
}








 //A função criar_componente é responsável por criar dinamicamente um componente HTML com base nos dados de um grupo.
 function criar_componente(id, aluno){     
            let div = document.getElementById("main")
            let grupoDiv = document.createElement("div")
            grupoDiv.setAttribute("class", "divGrupoStyle")
        
            let nomeGrupoDiv = document.createElement("div")
            let rotuloNomeGrupo = document.createElement("strong")
            rotuloNomeGrupo.textContent = "Nome do grupo:"
            nomeGrupoDiv.appendChild(rotuloNomeGrupo)
            let nomeGrupo = document.createElement("p")
            nomeGrupo.textContent = grupo.nome
            nomeGrupoDiv.appendChild(nomeGrupo)
            
            let nomeTurmaDiv = document.createElement("div")
            let rotuloTurma = document.createElement("strong")
            rotuloTurma.textContent = "Turma:"
            nomeTurmaDiv.appendChild(rotuloTurma)
            let nomeTurma = document.createElement("p")
            nomeTurma.textContent = grupo.turma
            nomeTurmaDiv.appendChild(nomeTurma)

            let iconeDiv = document.createElement("div")
            iconeDiv.setAttribute("class","divIconeStyle")

            let iconeRemocao = document.createElement("i")
            iconeRemocao.setAttribute("class", "iconeRemocaoStyle")
            iconeRemocao.classList.add("fa", "fa-trash", "iconeRemocaoStyle")
            iconeRemocao.addEventListener("click", (evento) => {console.log(evento); alert("Remoção de grupo.")})
            iconeDiv.appendChild(iconeRemocao)
            
            grupoDiv.appendChild(nomeGrupoDiv)
            grupoDiv.appendChild(nomeTurmaDiv)
            grupoDiv.appendChild(iconeDiv)
            div.appendChild(grupoDiv)
        }
        
        //A função listar busca os grupos e cria os componentes. 
        //A palavra-chave await é usada para aguardar a função get_grupos buscar os grupos antes de prosseguir.
        async function listar(){    
            let grupos = await get_grupos() 
            for(id_grupo in grupos){
                console.log(id_grupo)
                criar_componente(id_grupo, grupos[id_grupo])
            }
        }

        //A função get_grupos busca os grupos na API backend.
        //A palavra-chave await é usada para aguardar a resposta da API e, em seguida, converte a resposta para o formato JSON usando o método response.json().
        //Os grupos buscados são então registrados no console e retornados.
        async function get_grupos() {   
            const resposta = await fetch (`http://localhost:8080/api/v1/grupos/listar`, {method: "GET"})    
            const grupos = await resposta.json()
            console.log(grupos)
            return grupos   
        }

        listar()
</script>