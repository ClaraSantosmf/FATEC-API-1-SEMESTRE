<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciamento de Turma</title>
    <link rel="stylesheet" href="../front/style/gerenciamento_turmas.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo">Logo aqui</div>
      <div class="dots">...</div>
    </header>
    <h1 class="title">Gerenciamento de Turmas:</h1>
    <div class="turma-container">
      <div class="flex-warp-container">
        <!-- As turmas serão adicionadas automaticamente aqui -->
      </div>
    </div>
    <button class="add-turma-button">Adicionar Turma</button>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const turmaContainer = document.querySelector(".turma-container");
        // verifica click
        turmaContainer.addEventListener("click", function (event) {
          const target = event.target;

          // Verifique se o clique ocorreu em um ícone de deletar ou dentro do turma-square
          const turmaSquare = target.closest(".turma-square");
          if (turmaSquare) {
            const turmaId = turmaSquare.id; // adiciona o id
            if (target.classList.contains("trash-icon")) {
              event.stopPropagation();
              alert(`Cliquei no ícone de deletar do turma com ID: ${turmaId}`);
            } else if (target.classList.contains("turma-square")) {
              alert(`Cliquei no turma-square com ID: ${turmaId}`);
            }
            getGrupos(turmaId);
          }
        });
      });
      //requisicao http para buscar turmas
      async function getTurmas() {
        try {
          const response = await fetch(
            "http://127.0.0.1:8080/get/turmas" // busca turma
          );
          const Turmadata = await response.json();
          console.log(Turmadata);

          // insere turmas automaticamente
          // Seleciona o elemento onde deseja inserir as turmas
          const container = document.querySelector(".flex-warp-container");

          // Itera sobre os objetos do JSON e cria elementos HTML para cada turma
          for (const turmaId in Turmadata) {
            if (Turmadata.hasOwnProperty(turmaId)) {
              const turma = Turmadata[turmaId];

              const turmaSquare = document.createElement("div");
              turmaSquare.className = "turma-square";
              turmaSquare.id = `${turmaId}`; // adiciona o ID da turma ao turmaSquare

              const nomeTurma = document.createElement("p");
              nomeTurma.textContent = `Nome da Turma: ${turma.nome}`;

              const nomeProfessor = document.createElement("p");
              nomeProfessor.textContent = `Professor: ${turma.professor}`;

              turmaSquare.appendChild(nomeTurma);
              turmaSquare.appendChild(nomeProfessor);

              const imagemIcon = document.createElement("img");
              imagemIcon.src = "../front/icon/trash-icon.svg"; // Substitua pelo caminho correto da imagem
              imagemIcon.alt = "Ícone";
              imagemIcon.className = "trash-icon";
              imagemIcon.width = 20;
              imagemIcon.height = 20;
              imagemIcon.id = `${turmaId}`; // adiciona o ID da turma ao icone de deletar

              // Adiciona a imagem à "turma-square"
              turmaSquare.appendChild(imagemIcon);

              // Adiciona a turmaSquare ao container
              container.appendChild(turmaSquare);
            }
          }
        } catch (error) {
          console.error("Erro ao buscar dados da API -> ", error);
        }
      }
      async function getGrupos(turmaId) {
        try {
          const response = await fetch("http://127.0.0.1:8080/get/grupos");
          const gruposData = await response.json();
          console.log(gruposData);

          for (const grupoId in gruposData) {
            if (gruposData.hasOwnProperty(grupoId)) {
              const grupo = gruposData[grupoId];
              // Verifique se o grupo tem a turma com o ID desejado
              if (grupo.turma == turmaId) {
                const nomeGrupo = grupo.nome;
                console.log(`ID do Grupo: ${grupoId}`);
                console.log(`Nome do Grupo: ${nomeGrupo}`);
                console.log(`Nome do Grupo: ${turmaId}`);
              }
            }
          }
        } catch (error) {
          console.error(error);
        }
      }
      async function getAlunos() {
        try {
          const response = await fetch("http://127.0.0.1:8080/get/alunos");
          const alunosData = await response.json();
          console.log(alunosData);
          // Faça algo com os dados, como exibir na interface do usuário.
        } catch (error) {
          console.error(error);
        }
      }
      async function getGrupoAlunos() {
        try {
          const response = await fetch(
            "http://127.0.0.1:8080/get/grupo_alunos"
          );
          const grupolunosData = await response.json();
          console.log(grupolunosData);
          // Faça algo com os dados, como exibir na interface do usuário.
        } catch (error) {
          console.error(error);
        }
      }
      getTurmas();
      getAlunos();
      getGrupoAlunos();
    </script>
  </body>
</html>
