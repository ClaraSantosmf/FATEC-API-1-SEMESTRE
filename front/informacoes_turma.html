<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciamento de Alunos</title>
     <link rel="stylesheet" href="../front/style/informacoes_turma.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css"
    />
    <link rel="stylesheet" href="style/custom.css" />
  </head>
  <body>
    <header class="header">
      <a href="index.html">
        <img src="./imagens/Logo.png" alt="logo" />
      </a>
    </header>
  <body onload="preencher_info_turma(obter_id())">
    <div class="container-info">
        <div class="info-turma">
          <p class="fnomeTurma"></p>
          <p class="fnomeProfessor"></p>
        </div>
        <div class="container-ciclos">
          <p class="titulo-ciclos"><strong>Pesos Ciclos:</strong></p>
          <div class="ciclo-peso"></div>
        </div>
            
        </div>
    </div>
    <div class="aluno-container">
        <p class="aviso_ciclo_aberto">Ciclo aberto para nota: x</p>
        <div class="header-container">
          <div class="header-title titulo_alunos">Nome</div>
          <div class="header-title titulo_notas">Notas</div>
          <div class="header-title titulo_media">Media</div>
        </div>
          <div class="corpo_tabela">
            <!-- Os Alunos serão adicionadas automaticamente aqui -->
          </div>
    </div>
     <!-- Moleke -->
     <div class="muleke">
        <a href="index.html">
          <img src="./imagens/mascote2.png" alt="mascote" />
        </a>
      </div>
      <script>
        async function preencher_info_turma(id){
          const turma = await obter_turma(id)
          const PesoCiclo = await listar_ciclos_turma(id)
          console.log(turma["nome"])
          console.log(turma.professor)
          if (turma){
            const nomeTurmaElement = document.querySelector('.fnomeTurma');
            const nomeProfessorElement = document.querySelector('.fnomeProfessor');
            const cicloPeso = document.querySelector(".ciclo-peso");
            nomeTurmaElement.textContent = 'Nome turma: ' + turma["nome"];
            nomeProfessorElement.textContent = 'Nome professor: ' + turma["professor"];
            for (let chave in PesoCiclo){
              const pesoData = PesoCiclo[chave];

              const NomeCiclo = document.createElement("span");
              NomeCiclo.className = "ciclo";
              NomeCiclo.innerHTML = `C${pesoData.numero_ciclo}:`;

              const PesoNota = document.createElement("span");
              PesoNota.className = "peso";
              PesoNota.textContent = pesoData.peso_nota;

              cicloPeso.appendChild(NomeCiclo);
              cicloPeso.appendChild(PesoNota);
              }
              }
            }

        async function listar_ciclos_turma(id){
          const response = await fetch (`http://localhost:8080/api/v1/ciclos/listar/${id}`, {method: "GET"})
          const PesoCiclo = await response.json()
          console.log(PesoCiclo)
          return PesoCiclo
        }

        async function obter_turma(id) {
            const resposta = await fetch (`http://localhost:8080/api/v1/turmas/listar/${id}`, {method: "GET"})
            const turma = await resposta.json()
            console.log(turma)
            return turma
        }
        function obter_id(){ return new URLSearchParams(window.location.search).get('id')
        //        /** Recupera o id da turma presente como consulta na URL
        //  * @returns {string} id - o identificador único
        }


        function exibirAlunos(alunosData) {
          const container = document.querySelector(".corpo_tabela");

          for (const alunoId in alunosData) {
            if (alunosData.hasOwnProperty(alunoId)) {
              const aluno = alunosData[alunoId];
              const RAaluno = aluno.id;

              const alunoSquare = document.createElement("div");
              alunoSquare.className = "aluno-square";
              alunoSquare.id = `${aluno.id}`;

              const nomeAluno = document.createElement("p");
              nomeAluno.className = "aluno";
              nomeAluno.textContent = aluno.nome.charAt(0).toUpperCase() + aluno.nome.slice(1);

              alunoSquare.appendChild(nomeAluno);

              // Crie um campo "nota" para cada aluno
              const campoNota = document.createElement("div");
              campoNota.className = "campoNota";

              for (const cicloId in ciclo_nota) {
                if (ciclo_nota.hasOwnProperty(cicloId)) {
                  const id_ciclo = ciclo_nota[cicloId].id_ciclo;
                  const valorNota = ciclo_nota[cicloId].valor;

                  const InputNotas = document.createElement("input");
                  InputNotas.className = "valor";
                  InputNotas.type = "number";
                  InputNotas.value = valorNota;
                  InputNotas.id = id_ciclo;

                  // Verifique se a nota já foi atribuída para torná-la somente leitura
                  if (CicloAberto(id_ciclo)) {
                    InputNotas.setAttribute("readonly", true);
                  }

                  campoNota.appendChild(InputNotas);
                }
              }
              alunoSquare.appendChild(campoNota);

              const mediaAluno = document.createElement("div");
                  mediaAluno.className = "media";
                  mediaAluno.type = "number";
                  mediaAluno.innerHTML = "Media"
                  alunoSquare.appendChild(mediaAluno)
              container.appendChild(alunoSquare);
            }
          }
        }


        function CicloAberto(id_ciclo) {
          return true
        }

        exibirAlunos(getAlunos());
      </script>
  </body>
</html>